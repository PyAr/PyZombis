Usando sqlite3
==============

Notas de surfistas
------------------

+ La Federación de Surf tiene los siguientes datos: número del surfista,
  nombre, país, grado promedio, estilo, edad.
+ ¿Cómo usar estos datos?
+ Por ejemplo, quiero conocer a todos los surfistas mayores de 25
+ ¡Usando una base de datos!
+ En este caso utilizaremos una herramienta de Brython llamada indexedDB.

.. activecode:: ac_l42_1a
   :language: python3
   :python3_interpreter: brython

   Creando la base de datos de surfistas usando IndexedDB

   ~~~~
   from browser import document, window, html

   IDB = window.indexedDB

   def crearBD(*args):
       db = request.result
       # Creamos la tabla llamada surfers con llave primaria id
       surfersDB = db.createObjectStore("surfers", {"keyPath": "id"})

       # Creamos las demás columnas de la tabla surfers: nombre, país, promedio, tabla de surf y edad.
       surfersDB.createIndex("nombre", "nombre")
       surfersDB.createIndex("pais", "pais")
       surfersDB.createIndex("media", "media")
       surfersDB.createIndex("estilo", "estilo")
       surfersDB.createIndex("edad", "edad")

       # Llenamos la tabla con algunos datos
       surfersDB.put({"nombre": "Johnny 'wave-boy' Jones", "pais": "USA", "media": 8.32, "estilo": "Fish", "edad": 21, "id":101})
       surfersDB.put({"nombre": "Juan Martino", "pais": "Spain", "media": 9.01, "estilo": "Gun", "edad": 36, "id":102})
       surfersDB.put({"nombre": "Joseph 'smitty' Smyth", "pais": "USA", "media": 8.85, "estilo": "Cruizer", "edad": 18, "id":103})

       print("La base de datos fue creada, pero tenga en cuenta lo siguiente:")
       print("Si su base de datos ya fue creada este método no se volverá a ejecutar.")
       print("Si quiere hacer una modificación a la estructura de la base de datos debe")
       print("borrar las cookies de navegación para que el método se ejecute nuevamente.")

   def mostrar_registros(ev):
       db = request.result
       tx = db.transaction("surfers", "readonly")
       store = tx.objectStore("surfers")
       cursor = store.openCursor()

       def print_row(ev):
           res = ev.target.result
           if res:
               v = res.value
               for key in ["nombre", "pais", "media", "estilo", "edad"]:
                   print(f"{key}: {getattr(v, key)}")
               print("----------------------------------------")
               # Continuamos con el siguiente registro
               getattr(res, "continue")()

       cursor.bind("success", print_row)

   # Creamos la base de datos "surf"
   request = IDB.open("surf")
   request.bind("upgradeneeded", crearBD)

   # Mostramos todo lo que almacenamos con la función mostrar_registros
   request.bind("success", mostrar_registros)


.. activecode:: ac_l42_2a
   :language: python3
   :python3_interpreter: brython

   Mostrando solo los surfista mayores de 25 años

   ~~~~
   from browser import document, window, html

   IDB = window.indexedDB

   def mostrar_mayores_25(ev):
       db = request.result
       tx = db.transaction("surfers", "readonly")
       store = tx.objectStore("surfers")
       cursor = store.openCursor()

       def print_row(ev):
           res = ev.target.result
           if res:
               v = res.value
               if(getattr(v, "edad") >=25):
                  print("----------------------------------------")
                  for key in ["nombre", "pais", "media", "estilo", "edad"]:
                     print(f"{key}: {getattr(v, key)}")
               # Continuamos con el siguiente registro
               getattr(res, "continue")()

       cursor.bind("success", print_row)

   # Abrimos base de datos "surf" que creamos en el paso anterios
   request = IDB.open("surf")

   # Mostramos todos los surfistas mayores de 25 años con la función mostrar_mayores_25
   request.bind("success", mostrar_mayores_25)


.. image:: ../img/TWP42_002.png
   :height: 10.741cm
   :width: 16.879cm
   :align: center
   :alt: 
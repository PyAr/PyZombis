Usando SQL
==========

Notas de surfistas
------------------

+ La Federación de Surf tiene los siguientes datos: número del surfista,
  nombre, país, grado promedio, estilo, edad.
+ ¿Cómo usar estos datos?
+ Por ejemplo, quiero conocer a todos los surfistas mayores de 25
+ ¡Usando una base de datos! En este caso, SQL.

.. raw:: html

   <script src='https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.5.0/sql-wasm.js'></script>
   <script id="create-db-script">
      config = {
         locateFile: filename => `https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.5.0/sql-wasm.wasm`
      }
      initSqlJs(config).then(function(SQL){
         //Create the database
         window.db = new SQL.Database();

         //Create table surfers
         db.run("CREATE TABLE surfers (id, nombre, pais, media, estilo, edad)");

         //Insert records
         db.run("INSERT INTO surfers (id, nombre, pais, media, estilo, edad) VALUES (101, \"Johnny 'wave-boy' Jones\",\"USA\",8.32,\"Fish\",21)");
         db.run("INSERT INTO surfers (id, nombre, pais, media, estilo, edad) VALUES (102, \"Juan Martino\",\"Spain\",9.01,\"Gun\",36)");
         db.run("INSERT INTO surfers (id, nombre, pais, media, estilo, edad) VALUES (103, \"Joseph 'smitty' Smyth\",\"USA\",8.85,\"Cruizer\",18)");
         db.run("INSERT INTO surfers (id, nombre, pais, media, estilo, edad) VALUES (104, \"Stacey O'Neill\",\"Ireland\",8.91,\"Malibu\",22)");
         db.run("INSERT INTO surfers (id, nombre, pais, media, estilo, edad) VALUES (105, \"Aideen 'board babe' Wu\",\"Japan\",8.65,\"Fish\",24)");
         db.run("INSERT INTO surfers (id, nombre, pais, media, estilo, edad) VALUES (106, \"Zack 'bonnie-lad' MacFadden\",\"Scotland\",7.82,\"Thruster\",26)");
         db.run("INSERT INTO surfers (id, nombre, pais, media, estilo, edad) VALUES (107, \"Aaron Valentino\",\"Italy\",8.98,\"Gun\",19)");

         // writing table in browser console as test
         const res = db.exec("SELECT * FROM surfers");
         console.log(JSON.stringify(res));
         
      });
   </script>


+ Previamente fue creada una base de datos con una tabla llamada ``surfers``.
+ Esta tabla tiene la información de los participantes del torneo de surf organizada en las siguientes columnas: ``id``, ``nombre``, ``pais``, ``media``, ``estilo``, ``edad``.
+ ``id`` es un número entero que identifica al concursante.
+ ``nombre`` es una string con su nombre y su apodo (si tiene uno).
+ ``pais`` muestra el país que está representando en el torneo.
+ ``media`` es el promedio de puntos obtenidos en el torneo.
+ ``estilo`` es el estilo que tiene su tabla de surf.
+ ``edad`` es un número entero que muestra la edad del concursante.


.. activecode:: ac_l42_1
    :language: python3
    :python3_interpreter: brython

    En este ejercicio leeremos los datos de la tabla ``surfers`` y mostraremos
    solo los mayores a 25 con una instrucción SQL (conocidas como query).

    ~~~~
    from browser import document, html

    #esto no está funcionando aún pero esta es la idea:
   
    query = html.SCRIPT("const res = window.db.exec('SELECT * FROM surfers WHERE edad >25');console.log(JSON.stringify(res));")
    document <= query

    # y en vez de hacer un console.log() mostrarlo en el output de brython



.. image:: ../img/TWP42_002.png
   :height: 10.741cm
   :width: 16.879cm
   :align: center
   :alt: 

Sqlite3
-------

+ Existe una librería llamada sqlite3.
+ Con ésta podríamos hacer lo mismo y solo utilizando python.

.. code-block :: python

   import sqlite3
   base_datos = sqlite3.connect("surfersDB.sdb")
   base_datos.row_factory = sqlite3.Row
   cursor = base_datos.cursor()
   cursor.execute("select * from surfers where age > 25")
   linhas = cursor.fetchall()
   for linha in linhas:
      print("Nombre :",linha['name'])
      print("Pais  :",linha['country'])
      print("Media  :",linha['average'])
      print("Estilo :",linha['board'])
      print("Edad  :",linha['age'])
      print()
   cursor.close()
